<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta name="generator" content="GNU make coupled with GNU awk to parse templates. Markdown to parse contents." />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="author" content="Clément David" />
  <meta name="keywords" content="davidcl, clement, david, c.david86" />
  <meta name="description" content="Clément David's CV, articles and all official stuff." />
  <meta name="robots" content="all" />

  <title>GnuBasedWebGeneration: template.awk</title>
  <meta name="keywords" content="awk, template" />
  <link rel="stylesheet" type="text/css" href="/davidcl/styles/light.css" media="all" />
  <link rel="stylesheet" type="text/css" href="/davidcl/styles/print.css" media="print" />
  <link rel="stylesheet" type="text/css" href="/davidcl/styles/default.css" media="screen" />
  <link rel="stylesheet" type="text/css" href="/davidcl/styles/highlight.css" />
  
  
  <link rel="Shortcut Icon" type="image/x-icon" href="/davidcl/img/favicon.ico" />
</head>

<body>
  <div id="nonFooter">
    <div id="header"> <div id="banner"></div> <p><a href="/davidcl/index.xhtml">davidcl</a> > <a href="/davidcl/articles/index.xhtml">articles</a> > <a href="/davidcl/articles/GnuBasedWebGeneration/index.xhtml">GnuBasedWebGeneration</a> > template.awk</p> </div>
    <div id="toc"></div>
    <div id="contents"> <pre class="hl"><span class="hl slc">#</span>
<span class="hl slc"># This file parse tokens in the template and remplace them by the content file.</span>
<span class="hl slc">#</span>
<span class="hl slc"># Note: the input variable contains the content filename and output contains</span>
<span class="hl slc"># the output file name.</span>
<span class="hl slc">#</span>

<span class="hl kwa">BEGIN</span> <span class="hl sym">{</span>
	<span class="hl kwb">RS</span> <span class="hl sym">=</span> <span class="hl str">&quot;&quot;</span><span class="hl sym">;</span>
	already_printed <span class="hl sym">=</span> <span class="hl str">&quot;false&quot;</span><span class="hl sym">;</span>
<span class="hl sym">}</span>

<span class="hl sym">/</span>^<span class="hl sym">:</span>HEADER<span class="hl sym">:</span>$<span class="hl sym">/ {</span>
	<span class="hl kwa">print</span> <span class="hl str">&quot;&lt;a href=</span><span class="hl esc">\&quot;</span><span class="hl str">/davidcl/index.xhtml</span><span class="hl esc">\&quot;</span><span class="hl str">&gt;davidcl&lt;/a&gt; &gt; &quot;</span> <span class="hl sym">&gt;</span>output<span class="hl sym">;</span>
	num_directories <span class="hl sym">=</span> <span class="hl kwa">split</span> <span class="hl sym">(</span>output<span class="hl sym">,</span> path<span class="hl sym">,</span> <span class="hl str">&quot;/&quot;</span><span class="hl sym">);</span>
	<span class="hl kwa">for</span> <span class="hl sym">(</span>i<span class="hl sym">=</span><span class="hl num">1</span><span class="hl sym">;</span> i<span class="hl sym">&lt;</span>num_directories<span class="hl sym">;</span> i<span class="hl sym">++) {</span>
		<span class="hl kwa">print</span> <span class="hl str">&quot;&lt;a href=</span><span class="hl esc">\&quot;</span><span class="hl str">/davidcl/&quot;</span> path<span class="hl sym">[</span>i<span class="hl sym">]</span> <span class="hl str">&quot;</span><span class="hl esc">\&quot;</span><span class="hl str">&gt;&quot;</span> path<span class="hl sym">[</span>i<span class="hl sym">]</span> <span class="hl str">&quot;&lt;/a&gt;&quot;</span> <span class="hl sym">&gt;</span>output<span class="hl sym">;</span>
		<span class="hl kwa">print</span> <span class="hl str">&quot; &gt; &quot;</span> <span class="hl sym">&gt;</span>output<span class="hl sym">;</span>
	<span class="hl sym">}</span>

	name <span class="hl sym">=</span> path<span class="hl sym">[</span>num_directories<span class="hl sym">];</span>
	<span class="hl kwa">sub</span> <span class="hl sym">(/</span>.xhtml<span class="hl sym">/,</span> <span class="hl str">&quot;&quot;</span><span class="hl sym">,</span> name<span class="hl sym">);</span>
	<span class="hl kwa">print</span> name <span class="hl sym">&gt;</span>output<span class="hl sym">;</span>

	already_printed <span class="hl sym">=</span> <span class="hl str">&quot;true&quot;</span><span class="hl sym">;</span>
<span class="hl sym">}</span>

<span class="hl sym">/</span>^<span class="hl sym">:</span>CONTENT<span class="hl sym">:</span>$<span class="hl sym">/ {</span>
	<span class="hl kwa">while</span> <span class="hl sym">((</span><span class="hl kwa">getline</span> content <span class="hl sym">&lt;</span>input<span class="hl sym">) &gt;</span> <span class="hl num">0</span><span class="hl sym">)</span>
		<span class="hl kwa">print</span> content <span class="hl sym">&gt;</span>output<span class="hl sym">;</span>
	already_printed <span class="hl sym">=</span> <span class="hl str">&quot;true&quot;</span><span class="hl sym">;</span>
<span class="hl sym">}</span>

<span class="hl sym">/</span>^<span class="hl sym">:</span>TITLE<span class="hl sym">:</span>$<span class="hl sym">/ {</span>
	<span class="hl slc"># We only put the first line of text to the title</span>
	<span class="hl kwa">getline</span> content <span class="hl sym">&lt;</span>input<span class="hl sym">;</span>
	<span class="hl kwa">print</span> content <span class="hl sym">&gt;</span>output<span class="hl sym">;</span>
	<span class="hl kwa">close</span><span class="hl sym">(</span>input<span class="hl sym">)</span>
	already_printed <span class="hl sym">=</span> <span class="hl str">&quot;true&quot;</span><span class="hl sym">;</span>
<span class="hl sym">}</span>

<span class="hl sym">/</span>^<span class="hl sym">:</span>DATE<span class="hl sym">:</span>$<span class="hl sym">/ {</span>
	now <span class="hl sym">=</span> systime <span class="hl sym">();</span>
	string <span class="hl sym">=</span> strftime <span class="hl sym">(</span><span class="hl str">&quot;%Y-%m-%dT%H:%M:%S&quot;</span><span class="hl sym">,</span> now<span class="hl sym">);</span>
	tz_offset <span class="hl sym">=</span> strftime <span class="hl sym">(</span><span class="hl str">&quot;%z&quot;</span><span class="hl sym">,</span> now<span class="hl sym">);</span>
	<span class="hl slc"># Conversion from +0200 to +02:00</span>
	string2 <span class="hl sym">=</span> <span class="hl kwa">substr</span><span class="hl sym">(</span>tz_offset<span class="hl sym">,</span> <span class="hl num">1</span><span class="hl sym">,</span> <span class="hl num">3</span><span class="hl sym">)</span> <span class="hl str">&quot;:&quot;</span> <span class="hl kwa">substr</span><span class="hl sym">(</span>tz_offset<span class="hl sym">,</span> <span class="hl num">4</span><span class="hl sym">);</span>
	<span class="hl kwa">print</span> string string2 <span class="hl sym">&gt;</span>output<span class="hl sym">;</span>
	already_printed <span class="hl sym">=</span> <span class="hl str">&quot;true&quot;</span><span class="hl sym">;</span>
<span class="hl sym">}</span>

<span class="hl sym">/</span>^<span class="hl sym">:</span>HREF<span class="hl sym">:</span>$<span class="hl sym">/ {</span>
	<span class="hl kwa">print</span> <span class="hl str">&quot;/davidcl/&quot;</span> input <span class="hl sym">&gt;</span>output<span class="hl sym">;</span>
	already_printed <span class="hl sym">=</span> <span class="hl str">&quot;true&quot;</span><span class="hl sym">;</span>
<span class="hl sym">}</span>

<span class="hl sym">/</span>^<span class="hl sym">:</span>LOCAL_CSS<span class="hl sym">:</span>$<span class="hl sym">/ {</span>
	css <span class="hl sym">=</span> gensub <span class="hl sym">(/</span>\.html<span class="hl sym">/,</span> <span class="hl str">&quot;.css&quot;</span><span class="hl sym">,</span> <span class="hl str">&quot;g&quot;</span><span class="hl sym">,</span> input<span class="hl sym">);</span>
	<span class="hl kwa">if</span> <span class="hl sym">((</span><span class="hl kwa">getline</span> line <span class="hl sym">&lt;</span>css<span class="hl sym">) &gt;</span> <span class="hl num">0</span><span class="hl sym">)</span>
		<span class="hl kwa">print</span> <span class="hl str">&quot;&lt;link rel=</span><span class="hl esc">\&quot;</span><span class="hl str">stylesheet</span><span class="hl esc">\&quot;</span> <span class="hl str">type=</span><span class="hl esc">\&quot;</span><span class="hl str">text/css</span><span class="hl esc">\&quot;</span> <span class="hl str">href=</span><span class="hl esc">\&quot;</span><span class="hl str">&quot;</span> css <span class="hl str">&quot;</span><span class="hl esc">\&quot;</span> <span class="hl str">media=</span><span class="hl esc">\&quot;</span><span class="hl str">all</span><span class="hl esc">\&quot;</span> <span class="hl str">/&gt;&quot;</span> <span class="hl sym">&gt;</span>output<span class="hl sym">;</span>
	already_printed <span class="hl sym">=</span> <span class="hl str">&quot;true&quot;</span><span class="hl sym">;</span>
<span class="hl sym">}</span>

<span class="hl sym">{</span>
	<span class="hl kwa">if</span> <span class="hl sym">(</span>already_printed <span class="hl sym">!=</span> <span class="hl str">&quot;true&quot;</span><span class="hl sym">)</span>
		<span class="hl kwa">print</span> $<span class="hl num">0</span> <span class="hl sym">&gt;</span>output<span class="hl sym">;</span>

	already_printed <span class="hl sym">=</span> <span class="hl str">&quot;false&quot;</span><span class="hl sym">;</span>
<span class="hl sym">}</span>

</pre>
<!--HTML generated by highlight 2.7, http://www.andre-simon.de/-->
 </div>
  </div>

  <div id="footer">
    <p>© 2009+ Clément David - All texts and images can be used
    with respect to the <a href=
    "http://www.opensource.org/licenses/artistic-license-2.0.php">Artistic
    license 2.0</a>.<br /> Generated on 2010-01-10T22:46:08+01:00. 
    <a href="http://validator.w3.org/check/referer" title="Check the validity of this site&#8217;s XHTML">xhtml</a>
    <a href="http://jigsaw.w3.org/css-validator/check/referer" title="Check the validity of this site&#8217;s CSS">css</a>
    <a href="/davidcl/sitemap.xhtml" title="Sitemap of this site">sitemap</a> &nbsp;</p>
  </div>
</body>
</html>

